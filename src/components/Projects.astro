<section
    class="snap-start h-[100dvh] w-full relative overflow-hidden bg-[#030303]"
    id="projects"
    style="touch-action: pan-y;"
>
    <div class="absolute inset-0 z-0 pointer-events-none">
        <div
            class="absolute inset-0 transition-all duration-1000 opacity-100 scale-100 project-bg"
            id="bg-project-1"
        >
            <img
                alt="Project 1 Background"
                src="assets/img/project-1-bg.webp"
                class="w-full h-full object-cover grayscale-[20%]"
            />
            <div
                class="absolute inset-0 bg-gradient-to-b from-black/80 via-black/40 to-black/80"
            >
            </div>
        </div>
        <div
            class="absolute inset-0 transition-all duration-1000 opacity-0 scale-110 project-bg"
            id="bg-project-2"
        >
            <img
                alt="Project 2 Background"
                src="assets/img/project-2-bg.webp"
                class="w-full h-full object-cover"
            />
            <div
                class="absolute inset-0 bg-gradient-to-tr from-indigo-950/80 via-black/50 to-black/80"
            >
            </div>
        </div>
        <div
            class="absolute inset-0 transition-all duration-1000 opacity-0 scale-110 project-bg"
            id="bg-project-3"
        >
            <img
                alt="Project 3 Background"
                src="assets/img/project-3-bg.webp"
                class="w-full h-full object-cover"
            />
            <div
                class="absolute inset-0 bg-gradient-to-br from-emerald-950/80 via-black/50 to-black/80"
            >
            </div>
        </div>
    </div>

    <div class="absolute left-12 top-1/2 -translate-y-1/2 z-20 hidden md:block">
        <div class="overflow-hidden">
            <span
                id="project-number"
                class="text-[15rem] font-black leading-none opacity-10 text-white select-none"
                >01</span
            >
        </div>
    </div>

    <div
        class="absolute z-30 flex transition-all duration-500
           /* Móvil: Abajo y Horizontal */
           bottom-10 left-1/2 -translate-x-1/2 flex-row gap-4
           /* Desktop: Derecha y Vertical */
           md:bottom-auto md:top-1/2 md:right-12 md:-translate-y-1/2 md:left-auto md:translate-x-0 md:flex-col md:gap-6"
    >
        {
            [0, 1, 2].map((i) => (
                <button
                    aria-label={`Go to Project ${i + 1}`}
                    class="group flex items-center gap-4 transition-all outline-none project-dot-btn"
                    data-index={i}
                >
                    <span class="text-[10px] uppercase tracking-[0.3em] text-white opacity-0 md:group-hover:opacity-100 transition-opacity font-bold hidden md:block">
                        Proyecto {i + 1}
                    </span>

                    <div class="w-8 h-8 md:w-6 md:h-6 flex items-center justify-center">
                        <div
                            class={`w-2 h-2 rounded-full border border-white/50 dot-indicator transition-all duration-500 
                        ${i === 0 ? "bg-white scale-150 shadow-[0_0_10px_rgba(255,255,255,0.5)]" : "bg-transparent hover:border-white"}`}
                        />
                    </div>
                </button>
            ))
        }
    </div>

    <div
        id="horizontal-track"
        class="relative z-10 h-full flex flex-nowrap overflow-x-auto snap-x snap-mandatory no-scrollbar scroll-smooth"
    >
        <article
            class="snap-center min-w-full h-full flex-shrink-0 flex items-center justify-center px-6 md:px-10"
        >
            <div class="max-w-4xl text-center" data-animate-project>
                <h3
                    class="text-5xl md:text-9xl font-black text-white mb-6 md:mb-8 tracking-tighter uppercase leading-[0.9] md:leading-[0.8]"
                >
                    Local <br />
                    <span
                        data-i18n="project1_subtitle"
                        class="bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 to-purple-500"
                        >ShopSystem</span
                    >
                </h3>
                <p
                    class="text-base md:text-2xl text-gray-400 max-w-[280px] sm:max-w-md md:max-w-xl mx-auto font-light leading-relaxed px-2 md:px-0"
                    data-i18n="project1_description"
                >
                    Sistema de gestión para tiendas locales con inventario,
                    ventas y análisis integrado.
                </p>
                <div class="mt-8 md:mt-12">
                    <a
                        href="https://github.com/jonaykb/LocalShopSystemV2"
                        target="_blank"
                        class="px-8 py-3 md:px-10 md:py-4 border border-white/20 bg-white/5 backdrop-blur-md rounded-full hover:bg-white hover:text-black transition-all duration-500 text-xs md:text-sm uppercase tracking-widest font-bold inline-block"
                        data-i18n="project1_button"
                    >
                        Ver Repositorio
                    </a>
                </div>
            </div>
        </article>

        <article
            class="snap-center min-w-full h-full flex-shrink-0 flex items-center justify-center px-6 md:px-10"
        >
            <div
                class="max-w-4xl text-center opacity-0 translate-y-10 md:translate-y-20 transition-all duration-1000"
                data-animate-project
            >
                <h3
                    class="text-5xl md:text-9xl font-black text-white mb-6 md:mb-8 tracking-tighter uppercase leading-[0.9] md:leading-[0.8]"
                >
                    KB <br />
                    <span class="text-indigo-400" data-i18n="project2_subtitle"
                        >Discord Bot</span
                    >
                </h3>
                <p
                    data-i18n="project2_description"
                    class="text-base md:text-2xl text-gray-400 max-w-[280px] sm:max-w-md md:max-w-xl mx-auto font-light leading-relaxed px-2 md:px-0"
                >
                    Bot de Discord para gestionar comunidades y confirmaciones
                    para eventos.
                </p>
                <div class="mt-8 md:mt-12">
                    <a
                        href="https://github.com/jonaykb/KB_Discord_Bot"
                        target="_blank"
                        data-i18n="project2_button"
                        class="px-8 py-3 md:px-10 md:py-4 border border-indigo-500/30 bg-indigo-500/10 backdrop-blur-md rounded-full hover:bg-indigo-500 transition-all duration-500 text-xs md:text-sm uppercase tracking-widest font-bold inline-block"
                    >
                        Ver Repositorio
                    </a>
                </div>
            </div>
        </article>

        <article
            class="snap-center min-w-full h-full flex-shrink-0 flex items-center justify-center px-6 md:px-10"
        >
            <div
                class="max-w-4xl text-center opacity-0 translate-y-10 md:translate-y-20 transition-all duration-1000"
                data-animate-project
            >
                <h3
                    class="text-5xl md:text-9xl font-black text-white mb-6 md:mb-8 tracking-tighter uppercase leading-[0.9] md:leading-[0.8]"
                >
                    Cuidado <br />
                    <span class="text-indigo-400" data-i18n="project3_subtitle"
                        >Plantas</span
                    >
                </h3>
                <p
                    class="text-base md:text-2xl text-gray-400 max-w-[280px] sm:max-w-md md:max-w-xl mx-auto font-light leading-relaxed px-2 md:px-0"
                    data-i18n="project3_description"
                >
                    Red social en Laravel para compartir cuidados de plantas.
                </p>
                <div class="mt-8 md:mt-12">
                    <a
                        href="https://github.com/jonaykb/CuidadoPlantas-JonayContreras"
                        target="_blank"
                        data-i18n="project3_button"
                        class="px-8 py-3 md:px-10 md:py-4 border border-indigo-500/30 bg-indigo-500/10 backdrop-blur-md rounded-full hover:bg-indigo-500 transition-all duration-500 text-xs md:text-sm uppercase tracking-widest font-bold inline-block"
                    >
                        Ver Repositorio
                    </a>
                </div>
            </div>
        </article>
    </div>
</section>

<style>
    .no-scrollbar::-webkit-scrollbar {
        display: none;
    }
    .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
</style>

<script>
    // --- 1. LÓGICA DE PROYECTOS (HORIZONTAL) ---
    const track = document.getElementById("horizontal-track");
    const bgs = document.querySelectorAll(".project-bg");
    const projectsSection = document.getElementById("projects-section");

    let isScrollingActive = false;
    let sectionEntryTime = 0;
    const ENTRY_THRESHOLD = 600;
    const SCROLL_COOLDOWN = 500;
    let lastScrollTime = 0;
    let touchStartX = 0;
    let touchStartY = 0;

    const entryObserver = new IntersectionObserver(
        (entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    sectionEntryTime = Date.now();
                } else {
                    sectionEntryTime = 0;
                }
            });
        },
        { threshold: 0.5 },
    );

    if (projectsSection) entryObserver.observe(projectsSection);

    function actualizarInterfaz() {
        if (!track) return;

        const index = Math.round(track.scrollLeft / track.clientWidth);
        const projectNumber = document.getElementById("project-number");

        if (projectNumber)
            projectNumber.textContent = (index + 1).toString().padStart(2, "0");

        const dotContainers = document.querySelectorAll(".group[data-index]");
        dotContainers.forEach((container, i) => {
            const dot = container.querySelector(".dot-indicator") || container;
            if (i === index) {
                dot.classList.add("bg-white", "scale-150");
                dot.classList.remove("bg-transparent", "scale-100");
            } else {
                dot.classList.remove("bg-white", "scale-150");
                dot.classList.add("bg-transparent", "scale-100");
            }
        });

        bgs.forEach((bg, i) => {
            const text = document.querySelectorAll("[data-animate-project]")[i];
            if (i === index) {
                bg.style.opacity = "1";
                bg.style.transform = "scale(1)";
                if (text) text.classList.remove("opacity-0", "translate-y-20");
            } else {
                bg.style.opacity = "0";
                bg.style.transform = "scale(1.1)";
                if (text) text.classList.add("opacity-0", "translate-y-20");
            }
        });
    }

    track?.addEventListener(
        "wheel",
        (e) => {
            const isAtStart = track.scrollLeft <= 0;
            const maxScroll = track.scrollWidth - track.clientWidth;
            const isAtEnd = track.scrollLeft >= maxScroll - 10;
            const now = Date.now();

            const shouldCapture =
                (e.deltaY > 0 && !isAtEnd) || (e.deltaY < 0 && !isAtStart);

            if (shouldCapture) {
                e.preventDefault();
                const canStartNav = now - sectionEntryTime > ENTRY_THRESHOLD;
                const canMoveAgain = now - lastScrollTime > SCROLL_COOLDOWN;

                if (!isScrollingActive && canStartNav && canMoveAgain) {
                    isScrollingActive = true;
                    lastScrollTime = now;

                    const direction = e.deltaY > 0 ? 1 : -1;
                    track?.scrollBy({
                        left: direction * track.clientWidth,
                        behavior: "smooth",
                    });

                    setTimeout(() => {
                        isScrollingActive = false;
                    }, 600);
                }
            }
        },
        { passive: false },
    );

    track?.addEventListener(
        "touchstart",
        (e) => {
            touchStartX = e.touches[0].clientX;
            touchStartY = e.touches[0].clientY;
        },
        { passive: true },
    );

    track?.addEventListener(
        "touchmove",
        (e) => {
            const touchMoveX = e.touches[0].clientX;
            const touchMoveY = e.touches[0].clientY;

            const deltaX = touchStartX - touchMoveX;
            const deltaY = touchStartY - touchMoveY;

            if (Math.abs(deltaX) > Math.abs(deltaY)) {
                if (e.cancelable) e.preventDefault();
            }
        },
        { passive: false },
    );

    function moveTrack(direction: number) {
        const now = Date.now();
        const canStartNav = now - sectionEntryTime > ENTRY_THRESHOLD;
        const canMoveAgain = now - lastScrollTime > SCROLL_COOLDOWN;

        if (!isScrollingActive && canStartNav && canMoveAgain) {
            isScrollingActive = true;
            lastScrollTime = now;

            track?.scrollBy({
                left: direction * track.clientWidth,
                behavior: "smooth",
            });

            setTimeout(() => {
                isScrollingActive = false;
            }, 600);
        }
    }

    track?.addEventListener(
        "touchend",
        (e) => {
            const touchEndX = e.changedTouches[0].clientX;
            const deltaX = touchStartX - touchEndX;
            const threshold = 50;

            const isAtStart = track.scrollLeft <= 0;
            const maxScroll = track.scrollWidth - track.clientWidth;
            const isAtEnd = track.scrollLeft >= maxScroll - 10;

            if (Math.abs(deltaX) > threshold) {
                if (deltaX > 0 && !isAtEnd) {
                    moveTrack(1);
                } else if (deltaX < 0 && !isAtStart) {
                    moveTrack(-1);
                }
            }
        },
        { passive: true },
    );

    document.querySelectorAll(".group[data-index]").forEach((dot, i) => {
        dot.addEventListener("click", () => {
            track?.scrollTo({
                left: i * track.clientWidth,
                behavior: "smooth",
            });
        });
    });

    let isScrolling: NodeJS.Timeout;
    track?.addEventListener("scroll", () => {
        window.clearTimeout(isScrolling);
        isScrolling = setTimeout(() => {
            actualizarInterfaz();
        }, 50);
    });

    actualizarInterfaz();
</script>
