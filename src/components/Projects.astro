<section
    class="snap-start h-screen w-screen relative overflow-hidden bg-[#030303]"
    id="projects-section"
>
    <div class="absolute inset-0 z-0 pointer-events-none">
        <div
            class="absolute inset-0 transition-all duration-1000 opacity-100 scale-100 project-bg"
            id="bg-project-1"
        >
            <img
                src="https://images.unsplash.com/photo-1498050108023-c5249f4df085?q=80&w=2072"
                class="w-full h-full object-cover grayscale-[20%]"
            />
            <div
                class="absolute inset-0 bg-gradient-to-b from-black/80 via-black/40 to-black/80"
            >
            </div>
        </div>
        <div
            class="absolute inset-0 transition-all duration-1000 opacity-0 scale-110 project-bg"
            id="bg-project-2"
        >
            <img
                src="https://images.unsplash.com/photo-1555066931-4365d14bab8c?q=80&w=2070"
                class="w-full h-full object-cover"
            />
            <div
                class="absolute inset-0 bg-gradient-to-tr from-indigo-950/80 via-black/50 to-black/80"
            >
            </div>
        </div>
        <div
            class="absolute inset-0 transition-all duration-1000 opacity-0 scale-110 project-bg"
            id="bg-project-3"
        >
            <img
                src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?q=80&w=2070"
                class="w-full h-full object-cover"
            />
            <div
                class="absolute inset-0 bg-gradient-to-br from-emerald-950/80 via-black/50 to-black/80"
            >
            </div>
        </div>
    </div>

    <div class="absolute left-12 top-1/2 -translate-y-1/2 z-20 hidden md:block">
        <div class="overflow-hidden">
            <span
                id="project-number"
                class="text-[15rem] font-black leading-none opacity-10 text-white select-none"
                >01</span
            >
        </div>
    </div>

    <div
        class="absolute right-12 top-1/2 -translate-y-1/2 z-30 flex flex-col gap-6"
    >
        {
            [0, 1, 2].map((i) => (
                <button
                    class="group flex items-center gap-4 transition-all"
                    data-index={i}
                >
                    <span class="text-[10px] uppercase tracking-[0.3em] text-white opacity-0 group-hover:opacity-100 transition-opacity font-bold">
                        Proyecto {i + 1}
                    </span>
                    <div
                        class={`w-2 h-2 rounded-full border border-white/50 dot-indicator transition-all duration-500 ${i === 0 ? "bg-white scale-150" : "bg-transparent"}`}
                    />
                </button>
            ))
        }
    </div>

    <div
        id="horizontal-track"
        class="relative z-10 h-full flex flex-nowrap overflow-x-auto snap-x snap-mandatory no-scrollbar scroll-smooth"
    >
        <article
            class="snap-center min-w-full h-full flex-shrink-0 flex items-center justify-center project-text"
            data-index="0"
            data-target="#bg-project-1"
        >
            <div class="max-w-4xl text-center px-10" data-animate-project>
                <h3
                    class="text-7xl md:text-9xl font-black text-white mb-8 tracking-tighter uppercase leading-[0.8]"
                >
                    Digital <br />
                    <span
                        class="bg-clip-text text-transparent bg-gradient-to-r from-indigo-500 to-purple-500"
                        >Workspace</span
                    >
                </h3>
                <p
                    class="text-xl md:text-2xl text-gray-400 max-w-xl mx-auto font-light leading-relaxed"
                >
                    App Fullstack con arquitectura de microservicios y
                    sincronización en tiempo real.
                </p>
                <div class="mt-12">
                    <button
                        class="px-10 py-4 border border-white/20 bg-white/5 backdrop-blur-md rounded-full hover:bg-white hover:text-black transition-all duration-500 text-sm uppercase tracking-widest font-bold"
                    >
                        Explorar Caso
                    </button>
                </div>
            </div>
        </article>

        <article
            class="snap-center min-w-full h-full flex-shrink-0 flex items-center justify-center project-text"
            data-index="1"
            data-target="#bg-project-2"
        >
            <div
                class="max-w-4xl text-center px-10 opacity-0 translate-y-20 transition-all duration-1000"
                data-animate-project
            >
                <h3
                    class="text-7xl md:text-9xl font-black text-white mb-8 tracking-tighter uppercase leading-[0.8]"
                >
                    Discord <br />
                    <span class="text-indigo-400">Intelligence</span>
                </h3>
                <p
                    class="text-xl md:text-2xl text-gray-400 max-w-xl mx-auto font-light"
                >
                    Bot avanzado con integración de IA para gestión automatizada
                    de comunidades.
                </p>
                <div class="mt-12">
                    <button
                        class="px-10 py-4 border border-indigo-500/30 bg-indigo-500/10 backdrop-blur-md rounded-full hover:bg-indigo-500 transition-all duration-500 text-sm uppercase tracking-widest font-bold"
                    >
                        Ver Repositorio
                    </button>
                </div>
            </div>
        </article>
        <article
            class="snap-center min-w-full h-full flex-shrink-0 flex items-center justify-center project-text"
            data-index="2"
            data-target="#bg-project-3"
        >
            <div
                class="max-w-4xl text-center px-10 opacity-0 translate-y-20 transition-all duration-1000"
                data-animate-project
            >
                <h3
                    class="text-7xl md:text-9xl font-black text-white mb-8 tracking-tighter uppercase leading-[0.8]"
                >
                    Project <br />
                    <span class="text-indigo-400">Three</span>
                </h3>
                <p
                    class="text-xl md:text-2xl text-gray-400 max-w-xl mx-auto font-light"
                >
                    Description for project three goes here.
                </p>
                <div class="mt-12">
                    <button
                        class="px-10 py-4 border border-indigo-500/30 bg-indigo-500/10 backdrop-blur-md rounded-full hover:bg-indigo-500 transition-all duration-500 text-sm uppercase tracking-widest font-bold"
                    >
                        Ver Repositorio
                    </button>
                </div>
            </div>
        </article>
    </div>
</section>
<script>
    // --- 5. LÓGICA DE PROYECTOS (HORIZONTAL) ---
    const track = document.getElementById("horizontal-track");
    const bgs = document.querySelectorAll(".project-bg");
    const projectsSection = document.getElementById("projects-section");

    let isScrollingActive = false;
    let sectionEntryTime = 0; // Marca de tiempo de entrada
    const ENTRY_THRESHOLD = 600; // MS de espera al entrar
    const SCROLL_COOLDOWN = 500; // MS entre cada slide
    let lastScrollTime = 0;

    // Observer para detectar la entrada a la sección
    const entryObserver = new IntersectionObserver(
        (entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    sectionEntryTime = Date.now();
                } else {
                    sectionEntryTime = 0;
                }
            });
        },
        { threshold: 0.5 },
    );

    if (projectsSection) entryObserver.observe(projectsSection);

    function actualizarInterfaz() {
        if (!track) return;

        const index = Math.round(track.scrollLeft / track.clientWidth);
        const projectNumber = document.getElementById("project-number");

        if (projectNumber)
            projectNumber.textContent = (index + 1).toString().padStart(2, "0");

        const dotContainers = document.querySelectorAll(".group[data-index]");
        dotContainers.forEach((container, i) => {
            const dot = container.querySelector(".dot-indicator") || container;
            if (i === index) {
                dot.classList.add("bg-white", "scale-150");
                dot.classList.remove("bg-transparent", "scale-100");
            } else {
                dot.classList.remove("bg-white", "scale-150");
                dot.classList.add("bg-transparent", "scale-100");
            }
            // Nota: moví el eventListener fuera o asegúrate de que no se duplique
        });

        bgs.forEach((bg, i) => {
            const text = document.querySelectorAll("[data-animate-project]")[i];
            if (i === index) {
                bg.style.opacity = "1";
                bg.style.transform = "scale(1)";
                if (text) text.classList.remove("opacity-0", "translate-y-20");
            } else {
                bg.style.opacity = "0";
                bg.style.transform = "scale(1.1)";
                if (text) text.classList.add("opacity-0", "translate-y-20");
            }
        });
    }

    track?.addEventListener(
        "wheel",
        (e) => {
            const isAtStart = track.scrollLeft <= 0;
            const maxScroll = track.scrollWidth - track.clientWidth;
            const isAtEnd = track.scrollLeft >= maxScroll - 10;
            const now = Date.now();

            // Verificamos si el scroll debe ser capturado horizontalmente
            const shouldCapture =
                (e.deltaY > 0 && !isAtEnd) || (e.deltaY < 0 && !isAtStart);

            if (shouldCapture) {
                e.preventDefault();

                // 1. Validar que ha pasado el tiempo desde la entrada (Entry Threshold)
                const canStartNav = now - sectionEntryTime > ENTRY_THRESHOLD;
                // 2. Validar que ha pasado el tiempo desde el último movimiento (Cooldown)
                const canMoveAgain = now - lastScrollTime > SCROLL_COOLDOWN;

                if (!isScrollingActive && canStartNav && canMoveAgain) {
                    isScrollingActive = true;
                    lastScrollTime = now;

                    const direction = e.deltaY > 0 ? 1 : -1;
                    track?.scrollBy({
                        left: direction * track.clientWidth,
                        behavior: "smooth",
                    });

                    // Desbloqueamos después de la animación
                    setTimeout(() => {
                        isScrollingActive = false;
                    }, 600);
                }
            }
        },
        { passive: false },
    );

    // Click en bolitas (Sugerencia: moverlo a un bucle independiente una sola vez)
    document.querySelectorAll(".group[data-index]").forEach((dot, i) => {
        dot.addEventListener("click", () => {
            track?.scrollTo({
                left: i * track.clientWidth,
                behavior: "smooth",
            });
        });
    });

    let isScrolling: NodeJS.Timeout;
    track?.addEventListener("scroll", () => {
        window.clearTimeout(isScrolling);
        isScrolling = setTimeout(() => {
            actualizarInterfaz();
        }, 50);
    });

    actualizarInterfaz();
</script>
