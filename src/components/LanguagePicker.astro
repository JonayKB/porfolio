---
const availableLanguages = ["es", "en"];
---

<div
  class="z-[100] flex items-center gap-1 p-1 bg-white/5 light:bg-black/5 backdrop-blur-xl border border-white/10 light:border-black/10 rounded-full shadow-2xl transition-colors duration-700"
>
  {
    availableLanguages.map((lang) => (
      <button
        aria-label={`Switch to ${lang} language`}
        data-lang-btn={lang}
        class="px-4 py-1.5 rounded-full text-[10px] font-bold tracking-widest uppercase transition-all duration-500"
      >
        {lang}
      </button>
    ))
  }
</div>

<script>
  import { getLang, setLang } from "../i18n";

  const buttons = document.querySelectorAll("[data-lang-btn]");

  function updateActiveState(activeLang: string) {
    buttons.forEach((btn) => {
      const lang = btn.getAttribute("data-lang-btn");
      
      if (lang === activeLang) {
        btn.classList.add("bg-white", "light:bg-black", "text-black", "light:text-white", "shadow-lg");
        btn.classList.remove("text-gray-400", "light:text-gray-500", "hover:text-white", "light:hover:text-black");
      } else {
        btn.classList.remove("bg-white", "light:bg-black", "text-black", "light:text-white", "shadow-lg");
        btn.classList.add("text-gray-400", "light:text-gray-500", "hover:text-white", "light:hover:text-black");
      }
    });
  }

  // 1. InicializaciÃ³n
  updateActiveState(getLang());

  // 2. Eventos de Clic
  buttons.forEach((btn) => {
    btn.addEventListener("click", () => {
      const lang = btn.getAttribute("data-lang-btn");
      if (lang) {
        setLang(lang); // Esto dispara el CustomEvent 'language-change'
      }
    });
  });

  // 3. Escuchar el cambio reactivo
  window.addEventListener('language-change', (e: any) => {
    updateActiveState(e.detail.lang);
  });
</script>